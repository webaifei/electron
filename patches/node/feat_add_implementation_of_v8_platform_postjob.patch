From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Samuel Attard <sattard@slack-corp.com>
Date: Wed, 29 Jul 2020 12:03:04 -0700
Subject: feat: add implementation of v8::Platform::PostJob

Uses the new "v8::platform::NewDefaultJobHandle" method

Refs: https://chromium-review.googlesource.com/c/v8/v8/+/2315981
Refs: https://chromium-review.googlesource.com/c/v8/v8/+/2304812

diff --git a/src/node_platform.cc b/src/node_platform.cc
index eb918bdd559c404a0e311e0dd92cfee8940491bc..564edd033e6275a6dc34641ed7eb67f92011f972 100644
--- a/src/node_platform.cc
+++ b/src/node_platform.cc
@@ -550,6 +550,10 @@ Platform::StackTracePrinter NodePlatform::GetStackTracePrinter() {
   };
 }
 
+std::unique_ptr<v8::JobHandle> NodePlatform::PostJob(v8::TaskPriority priority, std::unique_ptr<v8::JobTask> job_task) {
+  return v8::platform::NewDefaultJobHandle(this, priority, std::move(job_task), 1 /* num_worker_threads */);
+}
+
 template <class T>
 TaskQueue<T>::TaskQueue()
     : lock_(), tasks_available_(), tasks_drained_(),
diff --git a/src/node_platform.h b/src/node_platform.h
index a7139ebdcc28d24087fb49697a0973331e0387a6..94cbfc9c55a9ace52f39e22eccfcd8b9eacd0186 100644
--- a/src/node_platform.h
+++ b/src/node_platform.h
@@ -165,6 +165,7 @@ class NodePlatform : public MultiIsolatePlatform {
   void UnregisterIsolate(v8::Isolate* isolate) override;
   void AddIsolateFinishedCallback(v8::Isolate* isolate,
                                   void (*callback)(void*), void* data) override;
+  std::unique_ptr<v8::JobHandle> PostJob(v8::TaskPriority priority, std::unique_ptr<v8::JobTask> job_task) override;
 
   std::shared_ptr<v8::TaskRunner> GetForegroundTaskRunner(
       v8::Isolate* isolate) override;
